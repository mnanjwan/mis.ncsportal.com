<!-- Base Template for all pages -->
<!-- Include this at the top of every page -->
<!DOCTYPE html>
<html class="h-full" data-kt-theme="true" data-kt-theme-mode="light" dir="ltr" lang="en">
<head>
    <title>NCS Employee Portal</title>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport"/>
    <link href="/favicon.ico" rel="shortcut icon"/>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;display=swap" rel="stylesheet"/>
    <link href="../../dist/assets/vendors/apexcharts/apexcharts.css" rel="stylesheet"/>
    <link href="../../dist/assets/vendors/keenicons/styles.bundle.css" rel="stylesheet"/>
    <link href="../../dist/assets/css/styles.css" rel="stylesheet"/>
</head>
<body class="antialiased flex h-full text-base text-foreground bg-background [--header-height:60px] [--sidebar-width:270px] lg:overflow-hidden bg-mono dark:bg-background">
    <!-- Theme Mode Script -->
    <script>
        const defaultThemeMode = 'light';
        let themeMode;
        if (document.documentElement) {
            if (localStorage.getItem('kt-theme')) {
                themeMode = localStorage.getItem('kt-theme');
            } else if (document.documentElement.hasAttribute('data-kt-theme-mode')) {
                themeMode = document.documentElement.getAttribute('data-kt-theme-mode');
            } else {
                themeMode = defaultThemeMode;
            }
            if (themeMode === 'system') {
                themeMode = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
            }
            document.documentElement.classList.add(themeMode);
        }
    </script>
    
    <!-- Page Structure -->
    <div class="flex grow">
        <!-- Header (Mobile) -->
        <header class="flex lg:hidden items-center fixed z-10 top-0 start-0 end-0 shrink-0 bg-mono dark:bg-background h-(--header-height)" id="header">
            <div class="kt-container-fixed flex items-center justify-between flex-wrap gap-3">
                <a href="#" id="dashboard-link">
                    <img class="size-[34px]" src="/logo.jpg"/>
                </a>
                <button class="kt-btn kt-btn-icon kt-btn-dim hover:text-white -me-2" data-kt-drawer-toggle="#sidebar">
                    <i class="ki-filled ki-menu"></i>
                </button>
            </div>
        </header>
        
        <!-- Wrapper -->
        <div class="flex flex-col lg:flex-row grow pt-(--header-height) lg:pt-0">
            <!-- Sidebar Container -->
            <div id="sidebar-container"></div>
            
            <!-- Main Content -->
            <div class="flex flex-col grow lg:rounded-l-xl bg-background border border-input lg:ms-(--sidebar-width)">
                <div class="flex flex-col grow kt-scrollable-y-auto lg:[--kt-scrollbar-width:auto] pt-5" id="scrollable_content">
                    <main class="grow" role="content">
                        <!-- Toolbar will be inserted here -->
                        <div id="toolbar-container"></div>
                        
                        <!-- Page Content -->
                        <div class="kt-container-fixed">
                            <div id="page-content">
                                <!-- Page specific content goes here -->
                            </div>
                        </div>
                    </main>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Notifications Drawer -->
    <div class="kt-drawer kt-drawer-end" data-kt-drawer="true" data-kt-drawer-name="notifications" id="notifications_drawer">
        <div class="kt-drawer-content flex flex-col w-full lg:w-[400px]">
            <div class="kt-drawer-header">
                <h3 class="kt-drawer-title">Notifications</h3>
                <button class="kt-btn kt-btn-sm kt-btn-icon kt-btn-ghost shrink-0" data-kt-drawer-dismiss="true">
                    <i class="ki-filled ki-cross"></i>
                </button>
            </div>
            <div class="kt-drawer-body flex flex-col gap-5 p-5" id="notifications-list">
                <!-- Notifications will be loaded here -->
            </div>
        </div>
    </div>
    
    <!-- Search Modal -->
    <div class="kt-modal" data-kt-modal="true" id="search_modal">
        <div class="kt-modal-content max-w-[600px] top-[15%]">
            <div class="kt-modal-header py-4 px-5">
                <i class="ki-filled ki-magnifier text-muted-foreground text-xl"></i>
                <input class="kt-input kt-input-ghost" name="query" placeholder="Tap to start search" type="text" value=""/>
                <button class="kt-btn kt-btn-sm kt-btn-icon kt-btn-dim shrink-0" data-kt-modal-dismiss="true">
                    <i class="ki-filled ki-cross"></i>
                </button>
            </div>
            <div class="kt-modal-body p-0 pb-5">
                <div class="kt-scrollable-y-auto" data-kt-scrollable="true" data-kt-scrollable-max-height="auto" data-kt-scrollable-offset="300px">
                    <div class="flex flex-col gap-2.5">
                        <div>
                            <div class="text-xs text-secondary-foreground font-medium pt-2.5 pb-1.5 ps-5">Quick Links</div>
                            <div class="kt-menu kt-menu-default px-0.5 flex-col" id="search-results">
                                <!-- Search results will appear here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Scripts -->
    <script src="../../dist/assets/js/core.bundle.js"></script>
    <script src="../../dist/assets/vendors/ktui/ktui.min.js"></script>
    <script src="../../dist/assets/vendors/apexcharts/apexcharts.min.js"></script>
    <script src="../../config/api.js"></script>
    <script src="../../js/auth.js"></script>
    <script src="../../js/utils.js"></script>
    <script src="../../components/sidebar.js"></script>
    <script src="../../components/layout.js"></script>
    
    <!-- Page-specific scripts -->
    <script>
        // Initialize page
        document.addEventListener('DOMContentLoaded', async () => {
            // Initialize auth
            const authenticated = await authManager.init();
            if (!authenticated) return;
            
            // Get user and role
            const user = authManager.getUser();
            const role = user.roles && user.roles.length > 0 ? user.roles[0] : 'Officer';
            
            // Initialize sidebar
            const sidebar = new SidebarComponent(user, role);
            sidebar.mount('sidebar-container');
            
            // Set dashboard link
            const dashboardLink = document.getElementById('dashboard-link');
            if (dashboardLink) {
                const layout = new LayoutComponent('', '');
                dashboardLink.href = layout.getDashboardPath();
            }
            
            // Load notifications
            loadNotifications();
        });
        
        // Load notifications
        async function loadNotifications() {
            try {
                const response = await apiService.get('/notifications?is_read=false&per_page=10');
                const notifications = response.data || [];
                const container = document.getElementById('notifications-list');
                
                if (container) {
                    if (notifications.length === 0) {
                        container.innerHTML = '<p class="text-sm text-secondary-foreground text-center">No new notifications</p>';
                    } else {
                        container.innerHTML = notifications.map(notif => `
                            <div class="flex grow gap-2.5">
                                <div class="kt-avatar size-8">
                                    <div class="kt-avatar-image">
                                        <img alt="avatar" src="../../dist/assets/media/avatars/300-1.png"/>
                                    </div>
                                </div>
                                <div class="flex flex-col gap-1 grow">
                                    <div class="text-sm font-medium">
                                        <span class="text-mono font-semibold">${notif.title}</span>
                                    </div>
                                    <span class="text-xs text-muted-foreground">${Utils.formatDateTime(notif.created_at)}</span>
                                </div>
                            </div>
                        `).join('');
                    }
                }
            } catch (error) {
                console.error('Failed to load notifications:', error);
            }
        }
    </script>
</body>
</html>

